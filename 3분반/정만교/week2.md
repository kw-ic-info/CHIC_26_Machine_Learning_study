# 데이터 정제 (Data Cleansing) 이해

## 데이터 정제란?
- **목적**: 분석 목적에 부합하는 데이터 품질 확보
- **중요성**: 전체 데이터 분석 작업의 약 80%가 전처리·정제에 소요
  > “Garbage in, garbage out” – 데이터 질이 결과 성능을 좌우

## 주요 프로세스
1. **문제 확인** – 데이터 품질 이슈 탐지
2. **중복 제거** – 중복 레코드 삭제/통합
3. **오류 수정** – 잘못 측정된 값 교정
4. **결측치 처리** – 누락값 보완
5. **수치형 이상치 탐지** – 비정상값 식별 및 처리

---

# 결측치 (Missing Value) 다루기

## 결측치 정의
- 관측된 데이터 중 특정 변수의 값이 **관측되지 않은 상태** (Python에서는 `NaN`)

## 결측치 발생 종류
| 유형 | 설명 | 예시 |
|------|------| ------ |
| **MCAR** (완전 무작위) | 결측치가 발생한 원인이 다른 변수의 값이나 결측된 값 자체와 아무런 상관이 없는 경우| (예: 센서 오류, 감지하지 못하는 이상치) |
| **MAR** (무작위) | 결측치가 발생할 확률이 관측된 다른 변수의 값에 의존하는 경우 | 해시계는 밤이 되면 측정할 수 없으므로, '시간(낮/밤)'이라는 관측 변수에 따라 결측 여부가 결정 |
| **MNAR** (비무작위) | 결측치가 발생한 원인이 결측된 값 자체와 관련이 있거나, 우리가 알 수 없는 복잡한 이유 때문인 경우  | 무료 PCR 검사를 받기 위해 고의로 설문을 누락하거나 거짓으로 응답 |

## 결측치 대체 방법
- **단순 대치법**: 행 삭제 또는 무시 (간편하지만 데이터 손실 위험)
- **평균/중앙값/최빈값 대치**: 통계량으로 대체
- **kNN 등 확률 대치법**: 가장 유연한 `k` 이웃 데이터 활용 (K-nearest neighbor 를 통한 statistic interpolation)
- **다중 대치법 (MICE 등)**: 여러 번 대치·통계적 편향 최소화 (가능한 모든 결측치 경우(m:5 ~ 20)를 모두 구해서 통계적으로 메꿈)

---

# 데이터 분포 변형 (Transformation)

## 변환 목적
- 특정 컨텍스트에 맞추거나 **스케일 영향 감소**

## 주요 변환 기법
- **표준화 (Standardization)**: 평균 0, 표준편차 1 로 변환 (`z‑score`) – 회귀·로지스틱 회귀 전처리
- **정규화 (Normalization)**: 0~1 범위 등으로 스케일링 – MinMax, Robust 스케일링 등
- **기타 변환**: **로그 변환**, **Box‑Cox 변환** – 왜도(스키워니스) 완화, 비선형 관계 선형화

---

# 범주형 변수 (Categorical Variable) 처리

## 범주형 변수 종류
- **명목형 (Nominal)** – 순서 없음
- **순서형 (Ordinal)** – 순서 존재

## 인코딩 기법
| 기법 | 설명 |
|------|------|
| **One‑Hot Encoding** | 각 범주를 0/1 벡터로 변환 – 직교성 확보, 다중 범주 시 희소 행렬 주의 |
| **Label / Ordinal Encoding** | 순서형에 숫자 부여 (0,1,2…) – 순서 정보 보존 |
| **Binary Encoding** | 이진법 사용 – One‑Hot 대비 변수 수 감소 |
| **Mean (Target) Encoding** | 종속변수 평균값으로 대체 – 과적합 위험 (데이터가 적을 경우) |
| **M‑estimator Encoding** | Target Encoding 파생형 – 정규화·우도 활용 |

---

# 이상치 (Outlier) 정의 및 처리

## 이상치 정의
- **일반적**: 다른 관측치와 현저히 차이 나는 데이터 포인트
- **선형 회귀**: 잔차(Residual) 크기가 매우 큰 관측치

## 모델에 미치는 영향
- **추정치 왜곡** → 결과·예측값 크게 변동
- **성능 저하** → 테스트 에러 상승, 상관계수(r) 감소
- **핵심 개념**:
  - **영향점 (Influential Point)** – 삭제 시 결과 크게 변함
    * 이 점 하나가 전체 모델을 얼마나 바꾸는가 &rarr;  의미 없는 outlier 일수도 있고, 유의미한 데이터 일수도 있음(case by case)
  - **가면 효과 (Masking Effect)** – 인접 이상치 때문에 탐지 어려움
    * 다른 outlier가 많아 분포가 정상 sample 처럼 보이는 현상
  - **수렁 효과 (Swamping Effect)** – 정상 관측치가 이상치로 오인
    * 강한 이상치 / 너무 clean 한 데이터셋 &rarr; 정상 샘플이 outlier 로 왜곡됨

## 이상치 탐지 방법
### 단변량 접근 (Univariate)
* ```y = Bx + e```
- **산점도 (Scatter plot)**
- **사분위수 범위 (IQR)** – `Q1 - 1.5*IQR` 이하 / `Q3 + 1.5*IQR` 이상
  * 통계학개론에서 배운 개념
- **Z‑score** – `|z| > 3` 일반적 기준
- **관리 한계선 (UCL/LCL)** – 평균 중심 변동 범위

### 다변량 접근 (Multivariate)
* ```y = B1x1 + B2x2 + ... + Bnxn + e ```
- **박스 플롯 (Box plot)**
- **Cook’s Distance** – `D > 1` 또는 사전 정의 기준 초과 시 이상치
- **기타**: Mahalanobis 거리, LOF, Isolation Forest 등

## 이상치 해결 방안
- **Robust 중심** 및 **Robust 공분산 행렬** 활용
- **Robust 회귀** 등 이상치에 강인한 모델 적용

---

# 요약
- **결측치**: 원인 파악 → 적절히 대체
- **스케일링**: 분석 알고리즘에 맞게 변환
- **범주형**: 적절한 인코딩으로 수치화
- **이상치**: 탐지·평가·적절히 처리 → 데이터 품질 확보

> 데이터 전처리는 **모델 성능**을 좌우하는 핵심 단계이며 작업량의 80%를 차지할 만큼 중요

---

# quiz

**문제 1.** 다음 중 **영향점 (influential point)** 에 대한 설명으로 가장 적절한 것은?

- ① 잔차(residual)가 매우 큰 관측치는 모두 영향점이다.
- ② 설명변수 값이 극단적이면 잔차 크기와 관계없이 항상 영향점이다.
- ③ 해당 관측치를 제거했을 때 회귀계수 또는 회귀선이 크게 변하는 관측치이다.
- ④ 영향점은 항상 데이터 오류이므로 제거해야 한다.
- ⑤ 영향점은 이상치와 동일한 개념이다.

**문제 2.** 다음 중 범주형 데이터 전처리 방식으로 잘못된 것은? (힌트 : nominal data 전처리 오류)

- ① 만족도(매우 불만–불만–보통–만족–매우 만족)를 1~5로 인코딩하였다.
- ② 학력 수준(고졸–대졸–대학원)을 1, 2, 3으로 인코딩하였다.
- ③ 성별(남, 여)을 0과 1로 이진 인코딩하였다.
- ④ 혈액형(A, B, AB, O)을 A=1, B=2, AB=3, O=4로 변환하였다.
- ⑤ 거주 지역(서울, 부산, 대구)을 One‑Hot Encoding(카테고리 소속 여부 0/1로 벡터 표현)으로 변환하였다.

**문제 3.** 결측치 유형(MCAR, MAR, MNAR)에 대한 설명으로 옳은 것을 고르시오.

- MCAR: 결측 발생이 다른 변수나 결측값 자체와 무관함
- MAR: 결측 발생이 관측된 다른 변수에 의존함
- MNAR: 결측 발생이 결측값 자체 또는 관측 불가능한 요인과 관련됨

올바른 연결은?

- ① 센서 오류로 무작위로 데이터가 누락된 경우 → MAR
- ② 야간에는 측정이 어려워 값이 자주 누락되며, 시간대 정보는 관측됨 → MNAR
- ③ 고소득자가 소득 응답을 의도적으로 회피하는 경우 → MCAR
- ④ 무작위 통신 오류로 특정 관측치가 누락된 경우 → MCAR
- ⑤ 설문 응답자가 민감한 질문을 회피하여 결측이 발생한 경우 → MAR








# quiz 정답
1. 3 (영향력이 가장 큰 점: 유의미한 데이터일수도, outlier 일수도)
2. 4
3. 4
  * 센서 오류로 무작위로 데이터가 누락된 경우 → MAR
  * 야간에는 측정이 어려워 값이 자주 누락되며, 시간대 정보는 관측됨 → MNAR
  * 고소득자가 소득 응답을 의도적으로 회피하는 경우 → MCAR
  * 무작위 통신 오류로 특정 관측치가 누락된 경우 → MCAR
  * 설문 응답자가 민감한 질문을 회피하여 결측이 발생한 경우 → MAR