# 정형 데이터 전처리 기법

## 개요
- **정형 데이터란?** matrix 형태의 데이터, structured data
- 이미지/시그널/텍스트 같은 **비정형 데이터**는 데이터 종류에 따라 전처리 기법이 달라짐  
- AI의 이론적인 근거를 찾기 위해서는 **정형 데이터 전처리**가 필요

---

## Data Cleansing

### 데이터 정제
- 데이터 분석 목적에 부합하는 **데이터 품질을 확보하기 위한 모든 데이터 작업** (정의가 매우 광범위)
- 데이터 수집 + 전처리(정제)는 데이터 분석 작업의 **80%**를 차지할 정도로 중요
- 데이터 품질이 좋지 않으면 전처리 결과도 좋을 수 없음 → **데이터 품질 고려 필요**
- 데이터 상태/특성에 맞는 **학습 모델 적용**이 필요

### Data Cleansing Checklist
- 최신 데이터인가 (업데이트가 필요한가)
- 데이터의 중복이 존재하는가  
  - 데이터 중복, 업데이트 필요 여부, 유니크 칼럼 부재, 불가능한 값, 분석 방향 오류 등은 전처리 영역
- 코드 체크
- 결측치가 있는가
- 절대 나올 수 없는 값(이상치)이 존재하는가
- 학습 모델 \( f(x) \) 를 정하는 이유: 실제와 비슷한 \( y' \) 를 찾기 위해  
  - 적절한 모델을 이 데이터로 찾을 수 있을까

### 데이터 오류 문제
- 데이터가 무엇이냐에 따라 전처리(process)가 달라져서 일반화된 정형 프로세스를 만들기 어려움  
  - 그중 하나: **5 major steps of data cleansing process**
    1. database 정의하기
    2. dirty data를 만드는 요소를 특정 짓는다
    3. 분석 품질에 영향을 주는 데이터 품질을 파악하고 우선순위를 매긴다
    4. bad data가 쌓이지 않도록 한다 (cleansing한 효과)
- 데이터 오류 원인을 추정하기 위해 확인할 부분  
  - 결측치, 노이즈, 이상치값

---

## 결측치 문제 다루기

### 결측치 정의
- 수집된 데이터 셋 중 **관측되지 않은 특정 확률변수(random variable, 매핑함수)의 값**
- 값의 특성: **0, NaN**
- 발생 원인
  - 센서 오류로 인한 수집 miss
  - 잘못된 분석 결과
  - 산술 연산 등 데이터 분석 시 에러 발생 (try-catch에서 에러 시 0/NaN을 넣는 경우)

### 결측치 해결에서 중요한 점
- 데이터 분석 시 결측치 문제 해결을 위해서는 **결측치 발생 사유를 이해**하는 것이 중요  
  - 특정 설문에만 응하지 않는 경우
  - 해당 값이 매우 드문 경우
  - 특정 개체에 대해 더 이상 정보를 얻을 수 없는 경우(생존 분석)
  - 개체에 따라 측정 난이도가 다른 경우
  - 중간 과정에서 유실이 생기는 경우 등

### 결측치 종류
#### MCAR (완전 무작위 결측)
- 결측치가 완전히 random으로 발생, 특정 변수와 연관성 없음
- 결측치 발생 변수의 특성과 무관하게 발생
- 관측치와 결측치에 모두 독립적 → 외부 변인
- 결측치 대체 전후 **분포 변화 없음**
- 데이터 수집 상황 총체적으로 점검 필요  
  - 관측치가 많다면 결측치 발생 변수를 지우는 것도 방법
- 예: 센서 오류, TCP 통신 중 데이터 누락 등  
- (변수와 변인이 완전히 독립)

#### MAR (무작위 결측)
- 결측치는 random으로 발생하지만, 결측 여부가 **관측값이 존재하는 특정 변수에 연관**
- 관측된 특정 변수로 결측치를 추정 가능
- 특정 변수값에 따른 조건부 발생 가능
- 다양한 결측치 대체 기법으로 추정 가능
- 예: 해시계 등 (해가 없으면 측정 불가)  
- (데이터 셋 내 특정 변수(결측치 발생X)와 결측 발생 변인 사이 엣지 존재)

#### MNAR (비무작위 결측)
- 결측치가 random으로 발생하지 않음  
  - MCAR/MAR 외 모든 경우로 볼 수 있음
- 관찰된 변수 또는 관찰되지 않은 변수에 연관
- 관측값과 결측값 모두에 영향을 받음
- 원인 특정이 어렵고 단순 대체법만으로 해결이 어려움
- 예: 거짓 설문 또는 누락 등  
- (결측치 발생 변수, 결측치 미발생 변수, 결측 발생 변인 사이 엣지 존재)

### 결측치 대체 방법
#### 단순 대치법 (complete analysis)
- 결측치가 포함된 자료를 무시하고 **완전 관측된 자료만**으로 데이터셋 구성
- 분석이 간편
- 관측치 부족 시 분석 기법에 대한 근거가 약해질 수 있음

#### 평균 대치법
- 관측 변수의 평균값으로 결측값 대체  
  - Mean / Median / Mode 모두 가능
  - 히스토그램을 그려보고 적용하는 것이 좋음
- 장점: 간편, 결측치 포함 관측치를 지우지 않음
- 단점: 통계량의 변량을 과소 추정하는 문제 발생

#### 단순 확률 대치법
- 결측치에 해당하는 관측치와 가장 가까운 **k개의 이웃**을 통해 대체
- 범주형: 최빈값 / 연속형: 중앙값 대체
- 단순 삭제/평균 대치법보다 정확도는 높을 수 있으나 모든 상황에 적합하진 않음

#### 다중 대치법
- n번의 단순 대치법을 반복 수행해 **n개 독립 데이터셋**을 생성 후 활용
- 단순 대치법은 직관적이지만 통계적으로 bias가 높고 정확도 성능이 부족할 수 있음
- 일반적인 3단계: **대치 적용 → 결과 평가 → 결과 병합**
- 예: MiceForest

#### 기타 대치 방법론
- GANs 기반 방식

---

## 데이터 분포 변형 방법론 (변수마다 스케일(min-max)이 다를 때)

### 스케일링(Rescaling)
- 의도한 컨텍스트에 맞추어 데이터 변환

### 표준화(Standardization)
- 데이터가 평균으로부터 얼마나 떨어져 분포하는지 표현하는 변환 (표준 정규 분포 변환 등)
- 중심극한의 정리와 표준 정규 분포 이용
- 관측된 변수의 모수 또는 표본 평균의 확률함수가 정규분포에 근사할 것이라는 가정
- 예: 선형회귀, 로지스틱회귀, 선형판별분석

### 정규화(Normalization)
- 상대적 크기에 대한 영향을 줄이기 위한 변환 (MinMax 스케일링 등)
- MinMax, Robust, [0,1] 스케일링
- 최솟값/최댓값 대비 해당 값의 상대적인 비로 나타냄
- 분포 가정이 필요 없거나 분포 가정에 의해 제약이 필요 없는 알고리즘 활용 시

---

## 범주형 변수 처리
- 모든 변수가 분석하기 편한 연속형 값으로 채워지지 않음
- CART 같은 특수 알고리즘은 범주형 변수 전처리가 필요 없을 수 있으나, 대부분은 학습 모델 구축을 위해 **범주형 → 연속형 전처리**가 필요
- 참고 도서: *Cleaning Data for Effective Data Science*
